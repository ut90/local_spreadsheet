# 製品要件定義（PRD）

## 製品概要
- 名称: ローカルスプレッドシート編集
- 目的: YAMLファイルを「スプレッドシート的な表形式」で直感的に編集できるデスクトップアプリ
- 実装: Electron（オフライン前提、ローカルファイルのみ）

## 背景/目的
- YAMLは設定やデータ定義で広く使われるが、階層構造やインデントにより編集が難しい。
- スプレッドシートのメンタルモデルで編集できれば、非エンジニアや軽作業での生産性が向上する。
- ローカル完結で既存のリポジトリ/ファイルを安全に扱いたい。

## 対象ユーザー
- YAMLを扱う開発者/運用担当/アナリスト
- 非エンジニアの業務担当（大量の値更新、一覧確認、軽微な修正）

## 主要ユースケース
- YAMLのキー/値を表形式で一括編集・確認
- リスト（配列）要素の追加/削除/並べ替え
- 既存YAMLの内容確認と軽微な修正、保存前の差分確認
- 型（数値/真偽/文字列/NULL）を保った編集
- フィルタ/検索で目的の行を素早く特定

## スコープ
- ゴール
  - ローカルYAMLの読み込み/編集/保存（上書き/別名保存）
  - 表形式での基本編集（追加/削除/コピー/ペースト/並べ替え/ドラッグ）
  - 配列・オブジェクト（マップ）・スカラ値に対応
  - 検索/フィルタ、Undo/Redo、変更差分の事前確認
  - マルチプラットフォーム配布（Windows/macOS/Linux）
- 非ゴール（初期）
  - リモート同期、コラボレーション、Git操作の内蔵
  - スキーマ自動推測の高度化、リッチな可視化
  - 大規模YAMLのストリーミング編集（10MB超は対象外の可能性）

## 機能要件（MVP）
- ファイル入出力
  - `ファイルを開く`（単一YAML）、`保存`、`別名で保存`
  - 文字コードはUTF-8を標準とする
  - 保存前に差分プレビュー（元YAMLとのdiff）を表示
- 表示/編集（表形式）
  - YAML階層を「パス（列）」×「レコード（行）」で表現するビューを提供
  - 配列は行として展開、マップは列またはツリーとして適切に表示
  - セル編集（Enterで確定、Escで取消）、複数選択、コピー/ペースト
  - 行の追加/削除/複製、並べ替え（ドラッグ&ドロップ）
  - 型の維持（true/false, 数値, null などを文字列化しない）
- 検索/フィルタ
  - 文字列検索（キー/値の部分一致）
  - 簡易フィルタ（列ごとの条件で表示行を絞り込み）
- 取り消し/やり直し
  - 直近の編集操作に対するUndo/Redo（無制限または実用的なヒストリ上限）
- エラーハンドリング
  - パース失敗時のエラー表示（行/列情報、原文表示）
  - 保存時の競合・書込失敗時のリカバリ（テンポラリ保存/バックアップ）
- ローカル性/オフライン
  - ネットワーク不要、外部送信なし

## 機能要件（将来/拡張）
- コメント・アンカー・エイリアスの保持（可能な範囲で往復変換の完全性向上）
- スキーマ検証（JSON Schema/YAMLスキーマ）とエラー箇所のハイライト
- 列レイアウトのプリセット/保存（特定YAMLに対するビュー定義）
- 大規模ファイルの遅延読み込み/仮想スクロール最適化
- Git連携（変更のステージ/コミット補助、差分比較）
- 複数ファイル/タブ、ウィンドウ間ドラッグ

## 品質要件
- パフォーマンス
  - 1MB程度のYAMLで快適に操作できること（開く<1s、操作応答<100ms目標）
- 信頼性/データ保護
  - 保存前自動バックアップ（例: `filename.yyyymmdd-hhmm.bak`）
  - 予期せぬ終了時の自動復元（自動保存のドラフト）
- 互換性
  - Windows/macOS/Linuxで動作（Electron配布）
  - Node/ElectronのLTSに追随
- アクセシビリティ/操作性
  - キーボード操作完備（セル移動、編集、行操作）
  - ズーム/フォントサイズ調整
- セキュリティ/プライバシー
  - ローカルファイル以外へデータ送信しない

## UI要件（MVP）
- メインビュー
  - 上部: ツールバー（開く/保存/別名保存/差分/検索）
  - 中央: グリッド（ツリー/列切替は将来検討）
  - 右部または下部: 差分/エラー/検証結果のパネル（トグル表示）
- ステータスバー
  - 現在ファイル名、行数/選択数、未保存変更の有無
- ダイアログ
  - パースエラー、保存時エラー、バックアップから復元

## 技術要件
- Electronベース（オフライン）
- YAMLパーサ
  - 型の往復保持、アンカー/コメントの保持は将来的要件
  - 文字列化の曖昧さ回避（例: 先頭0や日付の意図せぬ型変換対策）
- グリッド
  - 高速なセルレンダリング、仮想リスト（将来）
  - Undo/Redoスタック管理
- 差分
  - 保存前の旧/新YAMLのテキストdiffを表示

## 計測/成功指標
- クラッシュ率、保存失敗率（ゼロを目標）
- 1MBファイルでの操作応答時間
- ユーザー作業時間短縮（主観フィードバック）

## マイルストーン
- M1: MVP
  - 開く/編集/保存、検索、Undo/Redo、差分プレビュー、基本エラーハンドリング
- M2: 品質向上
  - 自動バックアップ、復元、設定、簡易フィルタ、配列ドラッグ並べ替え
- M3: 互換性/完全性
  - コメント/アンカー保持の向上、スキーマ検証、仮想スクロール

## リスク/懸念
- YAMLのコメント/アンカー/フォーマットの完全往復は難度が高い
- 巨大ファイルでのパフォーマンス劣化
- 型の自動判定ミスによる意図しない変換

## オープンクエスチョン
- コメント保持の優先度とスコープ（必須かベストエフォートか）
- 既定ビュー（ツリー/グリッド）と列定義の仕様
- 対応対象のYAML上限サイズ

