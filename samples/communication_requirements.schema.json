{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/schemas/communication_requirements.schema.json",
  "title": "他システム通信要件一覧 スキーマ",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "要件": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/Requirement" }
    }
  },
  "required": ["要件"],
  "$defs": {
    "Requirement": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "名称": { "type": "string", "minLength": 1 },
        "自システム": { "type": "string", "minLength": 1 },
        "自システムサーバー": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Server" }
        },
        "他システム": { "type": "string", "minLength": 1 },
        "他システムサーバー": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Server" }
        },
        "プロトコル": {
          "type": "string",
          "enum": ["HTTPS", "HTTP", "SFTP", "FTPS", "AMQP", "AMQPS", "TCP", "UDP"]
        },
        "ポート": { "type": "integer", "minimum": 1, "maximum": 65535 },
        "通信方向": { "type": "string", "enum": ["自→他", "他→自", "相互"] },
        "通信NW": { "type": "string", "enum": ["インターネット", "VPN", "閉域"] },
        "通信内容": { "type": "string", "minLength": 1 },
        "通信時間帯": {
          "type": "string",
          "pattern": "^(24H|(.{0,16}\\s)?[0-2]\\d:[0-5]\\d-[0-2]\\d:[0-5]\\d(\\s[A-Z]{2,5})?)$"
        },
        "備考": { "type": "string" },
        "変更履歴": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^\\d{4}/\\d{1,2}/\\d{1,2}\\s.+$"
          }
        }
      },
      "required": [
        "名称",
        "自システム",
        "自システムサーバー",
        "他システム",
        "他システムサーバー",
        "プロトコル",
        "ポート",
        "通信方向",
        "通信NW",
        "通信内容",
        "通信時間帯"
      ]
    },
    "Server": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "名称": { "type": "string", "minLength": 1 },
        "ホスト": {
          "type": "string",
          "pattern": "^[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?(?:\\.[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?)*$"
        },
        "IP": {
          "type": "string",
          "anyOf": [
            { "format": "ipv4" },
            { "format": "ipv6" }
          ]
        }
      },
      "required": ["名称", "ホスト", "IP"]
    }
  }
}

